<!DOCTYPE html>
<html lang="zh-CN">
<head><meta name="generator" content="Hexo 3.9.0">
    <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, minimum-scale=1.0">
<meta http-equiv="X-UA-Compatible" content="ie=edge">

    <meta name="author" content="Philon">


    <meta name="subtitle" content="ä½•ä»¥è§£å¿§ï¼Œå”¯æœ‰ i++">


    <meta name="description" content="ä¸€ä¸ªç¨‹åºå‘˜çš„æˆé•¿è¶³è¿¹">


    <meta name="keywords" content="è‡ªå¾‹ arts ç¼–ç¨‹ å¼€å‘ c/c++ java web go è¯»ä¹¦ å†™ä½œ">


<title>å…­ï¼šå¹¶å‘ | è‡ªå¢äººç”Ÿ</title>



    <link rel="icon" href="/favicon.ico">




    <!-- stylesheets list from _config.yml -->
    
    <link rel="stylesheet" href="/css/style.css">
    



    <!-- scripts list from _config.yml -->
    
    <script src="/js/script.js"></script>
    
    <script src="/js/tocbot.min.js"></script>
    



    
    
        
    


</head>
<body>
    <div class="wrapper">
        <header>
    <nav class="navbar">
        <div class="container">
            <div class="navbar-header header-logo">
                <div class="twolines-nav">
  <div class="twolines-nav-menu" onclick="this.classList.toggle('open-menu')"></div>
  <div class="twolines-nav-darkmode"></div>
  <div class="twolines-nav-prev"></div>
  <div class="twolines-nav-next"></div>
  <div class="twolines-nav-backtop"></div>
</div>

<style>
  .twolines-nav {
    margin-top: 1em;
    cursor: pointer;
  }
  .twolines-nav-menu {
    position: relative;
    top: 0em;
    left: 1em;
    width: 40px;
    height: 15px;
  }
  
  .twolines-nav-menu::before, .twolines-nav-menu::after {
    display: block;
    content: "";
    width: 100%;
    height: 2px;
    background-color: #aaaaaa;
    margin-top: 12px;
    transition: 0.3s;
  }

  .open-menu.twolines-nav-menu::before {
    transform: rotate(45deg) translate(10px, 10px);
  }
  .open-menu.twolines-nav-menu::after {
    transform: rotate(-45deg);
  }
</style>
                <!-- <a href="/">è‡ªå¢äººç”Ÿ</a> -->
            </div>
            <div class="menu navbar-right">
                
                    <a class="menu-item" href="/books">è¯»ä¹¦</a>
                
                    <a class="menu-item" href="/notes">æŠ€æœ¯</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
                <input id="switch_default" type="checkbox" class="switch_default">
                <label for="switch_default" class="toggleBtn"></label>
            </div>
        </div>
    </nav>

    
    <nav class="navbar-mobile" id="nav-mobile">
        <div class="container">
            <div class="navbar-header">
                <div>
                    <a href="/">è‡ªå¢äººç”Ÿ</a><a id="mobile-toggle-theme">Â·&nbsp;Light</a>
                </div>
                <div class="menu-toggle" onclick="mobileBtn()">&#9776; Menu</div>
            </div>
            <div class="menu" id="mobile-menu">
                
                    <a class="menu-item" href="/books">è¯»ä¹¦</a>
                
                    <a class="menu-item" href="/notes">æŠ€æœ¯</a>
                
                    <a class="menu-item" href="/category">Categories</a>
                
                    <a class="menu-item" href="/tag">Tags</a>
                
                    <a class="menu-item" href="/about">About</a>
                
            </div>
        </div>
    </nav>

</header>
<script>
    var mobileBtn = function f() {
        var toggleMenu = document.getElementsByClassName("menu-toggle")[0];
        var mobileMenu = document.getElementById("mobile-menu");
        if(toggleMenu.classList.contains("active")){
           toggleMenu.classList.remove("active")
            mobileMenu.classList.remove("active")
        }else{
            toggleMenu.classList.add("active")
            mobileMenu.classList.add("active")
        }
    }
</script>
        <div class="main">
            <div class="container">
    
    
        <div class="post-toc">
    <div class="tocbot-list"></div>
</div>

<script>
    document.ready(
        function () {
            tocbot.init({
                tocSelector: '.tocbot-list',
                contentSelector: '.post-content',
                headingSelector: 'h1, h2, h3, h4, h5',
                collapseDepth: 1,
                orderedList: false,
                scrollSmooth: true,
            })
        }
    )

    function expand_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 6,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "collapse_toc()");
        b.innerHTML = "Collapse all"
    }

    function collapse_toc() {
        var b = document.querySelector(".tocbot-toc-expand");
        tocbot.init({
            tocSelector: '.tocbot-list',
            contentSelector: '.post-content',
            headingSelector: 'h1, h2, h3, h4, h5',
            collapseDepth: 1,
            orderedList: false,
            scrollSmooth: true,
        });
        b.setAttribute("onclick", "expand_toc()");
        b.innerHTML = "Expand all"
    }

    function go_top() {
        window.scrollTo(0, 0);
    }

    function go_bottom() {
        window.scrollTo(0, document.body.scrollHeight);
    }

</script>
    

    
    <article class="post-wrap">
        <header class="post-header" title="å‘è¡¨äº2019/02/24">
            
            
                <a class="post-category" href="/categories/ã€ŠGOè¯­è¨€å®æˆ˜ã€‹å­¦ä¹ ç¬”è®°/">ã€ŠGOè¯­è¨€å®æˆ˜ã€‹å­¦ä¹ ç¬”è®°</a>
            
            <!-- 
                <div class="post-meta">
                    
                        <span class="post-time">2019/02/24</span>
                    
                </div>
             -->
            
            <h1 class="post-title">å…­ï¼šå¹¶å‘</h1>
        </header>

        <div class="post-content">
            <p>ä½†å‡¡å¤æ‚ä¸€ç‚¹çš„ä¸šåŠ¡ï¼Œå¹¶å‘åŸºæœ¬è·‘ä¸äº†ï¼Œå…¶å®è¯´ç™½äº†æ— éæ˜¯å¤šçº¿ç¨‹/å¤šè¿›ç¨‹æ¶æ„ï¼Œå¯ä¸€æ—¦æ¶‰åŠå¹¶å‘æ¨¡å¼ï¼Œå°‘ä¸äº†è°ƒåº¦ã€åŒæ­¥ã€äº’æ–¥ã€èµ„æºè®¿é—®ç­‰ä¸€å †å †é—®é¢˜ï¼Œè§£å†³è¿™äº›é—®é¢˜åˆéœ€è¦ä¸€å †å †ä»£ç ï¼Œè¿™äº›ä»£ç ä¸ä»…ç»´æŠ¤éš¾åº¦é«˜ï¼Œè€Œä¸”å¯ä»¥è¯´å’Œä¸šåŠ¡æœ¬èº«æ²¡æœ‰åŠæ¯›é’±å…³ç³»(çº¯ç²¹çš„æŠ€æœ¯é—®é¢˜æœ‰æœ¨æœ‰)ã€‚</p>
<p>Butï¼GOè¯­è¨€å¯¹å¹¶å‘çš„è¿ç”¨ç›¸æ¯”å…¶å®ƒè¯­è¨€è¿˜æ˜¯ç›¸å½“æ„‰å¿«çš„ã€‚æ ¹æ®æœ¬ç« å†…å®¹å¯ä»¥å­¦åˆ°ï¼ŒGOè¯­è¨€çš„â€œå¤šçº¿ç¨‹â€æœºåˆ¶goroutineï¼Œä»¥åŠå¤šçº¿ç¨‹ä¹‹é—´çš„é€šä¿¡æ–¹å¼channelã€‚</p>
<h2 id="GOè¿è¡Œæ—¶-runtime"><a href="#GOè¿è¡Œæ—¶-runtime" class="headerlink" title="GOè¿è¡Œæ—¶(runtime)"></a>GOè¿è¡Œæ—¶(runtime)</h2><p>åœ¨è¯´GOçš„å¹¶å‘ä¹‹å‰éœ€è¦å…ˆææ¸…æ¥šä¸€ä»¶äº‹ï¼Œå¦åˆ™åé¢ä¼šä¸€å¤´é›¾æ°´ã€‚</p>
<p>ç”±äºå‰å‡ ç« å¹¶æ²¡æœ‰ç‰¹åˆ«è¯´æ˜ï¼ŒåŠ ä¸Š<code>go build</code>å‘½ä»¤å¯ä»¥ç›´æ¥ç”Ÿæˆä¸€ä¸ªç‹¬ç«‹çš„å¯æ‰§è¡Œæ–‡ä»¶(è€Œä¸”æ²¡æœ‰ä»»ä½•ä¾èµ–)ï¼Œä¼šè®©äººè¯¯ä»¥ä¸ºgoç¨‹åºæ˜¯ç±»ä¼¼c/c++ä¸€æ ·çš„æœºå™¨ç ã€‚å…¶å®ä¸ç„¶ï¼Œ<strong>GOçš„å¯æ‰§è¡Œæ–‡ä»¶å†…éƒ¨åµŒå…¥äº†runtimeï¼Œæœ¬è´¨ä¸Šå’ŒJava/.Netä¸€æ ·è·‘åœ¨è™šæ‹Ÿæœºä¹‹ä¸Š</strong>ã€‚</p>
<p>GOçš„è¿è¡Œæ—¶è´Ÿè´£å†…å­˜ç®¡ç†ã€åƒåœ¾å›æ”¶ã€æ ˆå¤„ç†ç­‰ç­‰ï¼Œè€Œå…¶ä¸­ä¸€ä¸ªå¾ˆé‡è¦çš„åŠŸèƒ½ä¾¿æ˜¯goroutineå’Œchannelçš„ç®¡ç†ã€‚</p>
<p>é€šå¸¸æƒ…å†µä¸‹ï¼ŒGOè¿è¡Œæ—¶é»˜è®¤ç»™æ•´ä¸ªåº”ç”¨ç¨‹åºåˆ†é…ä¸€ä¸ªé€»è¾‘å¤„ç†å™¨ï¼Œé€»è¾‘å¤„ç†å™¨ä¼šç»‘å®šåˆ°ç‰©ç†å¤„ç†å™¨ä¸Šã€‚ä¸€ä¸ªGOç¨‹åºé»˜è®¤æœ€å¤šåˆ›å»º10000ä¸ªçº¿ç¨‹ï¼Œä½†å¯ä»¥é€šè¿‡runtimeåŒ…çš„<code>SetMaxThreads</code>æ–¹æ³•æ¥ä¿®æ”¹ï¼Œç¨‹åºé‡Œçš„çº¿ç¨‹è¶…å‡ºæœ€å¤§çº¿ç¨‹æ•°ä¼šå¯¼è‡´ç¨‹åºå´©æºƒã€‚</p>
<h2 id="goroutine"><a href="#goroutine" class="headerlink" title="goroutine"></a>goroutine</h2><p>æ‰€ä»¥é€šè¿‡ä¸Šè¿°è¦ææ‡‚ï¼Œgoroutineä¸æ˜¯ç³»ç»Ÿåˆ†é…çš„çº¿ç¨‹ï¼Œæ›´ä¸å½’æ“ä½œç³»ç»Ÿè°ƒåº¦ï¼Œä¸€åˆ‡éƒ½æ˜¯é è¿è¡Œæ—¶åˆ†é…å’Œè°ƒåº¦ã€‚ä½†ä¸è®ºå¦‚ä½•ï¼Œä¸ºäº†ä¾¿äºå‰æœŸçš„å­¦ä¹ å’Œç†è§£å¹¶å‘ï¼Œè¿™é‡Œé»˜è®¤goroutineå°±æ˜¯çº¿ç¨‹ã€‚</p>
<p>å…ˆæ¥åˆ›å»º10ä¸ªçº¿ç¨‹ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">  wg.Add(<span class="number">10</span>) <span class="comment">// WaitGroupè®¡æ•°åŠ 10</span></span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">10</span>; i++ &#123;</span><br><span class="line">    <span class="comment">// åˆ›å»ºgoroutine</span></span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">(id <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">      fmt.Printf(<span class="string">"Goroutine-%d\n"</span>, id)</span><br><span class="line">      wg.Done() <span class="comment">// WaitGroupè®¡æ•°å‡1</span></span><br><span class="line">    &#125;(i)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  wg.Wait() <span class="comment">// ç­‰å¾…ï¼Œç›´åˆ°WaitGroupè®¡æ•°ä¸º0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>ä»£ç è¾“å‡ºï¼š</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">Goroutine-2</span><br><span class="line">Goroutine-9</span><br><span class="line">Goroutine-1</span><br><span class="line">Goroutine-3</span><br><span class="line">Goroutine-5</span><br><span class="line">Goroutine-8</span><br><span class="line">Goroutine-4</span><br><span class="line">Goroutine-7</span><br><span class="line">Goroutine-6</span><br><span class="line">Goroutine-0</span><br></pre></td></tr></table></figure>

<p>ä»ä¸Šé¢ä»£ç å¯ä»¥çœ‹å‡ºï¼Œforå¾ªç¯åªæ˜¯é¡ºåºåˆ›å»ºäº†10ä¸ªgoroutineï¼Œä½†è¾“å‡ºæ˜¯å¹¶è¡Œçš„ï¼Œæ²¡æœ‰é¡ºåºã€‚</p>
<p>å†å¼ºè°ƒä¸€éï¼Œ<strong>goroutineä¸æ˜¯çº¿ç¨‹</strong></p>
<p>å°½ç®¡ä»æ•ˆæœä¸Šçœ‹ï¼Œgoroutineå°±æ˜¯çº¿ç¨‹ï¼Œä½†äº‹å®æ˜¯ä¸Šè¾¹çš„ç¨‹åºåªæœ‰ä¸€ä¸ªçº¿ç¨‹ï¼Œäº¤ç”±goè¿è¡Œæ—¶ç»´æŠ¤ï¼Œçº¿ç¨‹å†…éƒ¨ä¼šè‡ªåŠ¨è´Ÿè´£å¤šä¸ªgoroutineçš„è°ƒåº¦ç®¡ç†ã€‚</p>
<h2 id="å¹¶å‘ç«äº‰"><a href="#å¹¶å‘ç«äº‰" class="headerlink" title="å¹¶å‘ç«äº‰"></a>å¹¶å‘ç«äº‰</h2><p>æœ‰å¹¶å‘çš„åœ°æ–¹ï¼Œå°±æœ‰èµ„æºç«äº‰ã€‚åªéœ€è¦æŠŠä¸Šè¾¹çš„ä»£ç ç¨ä½œæ”¹åŠ¨ï¼š</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> count <span class="keyword">int</span> <span class="comment">// å£°æ˜ä¸€ä¸ªå…¨å±€å˜é‡</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">main</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line">  wg.Add(<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">go</span> <span class="function"><span class="keyword">func</span><span class="params">()</span></span> &#123;</span><br><span class="line">      <span class="keyword">defer</span> wg.Done() <span class="comment">// ğŸ‘ˆåŒ¿åå‡½æ•°é€€å‡ºæ—¶è°ƒç”¨</span></span><br><span class="line"></span><br><span class="line">      <span class="keyword">var</span> num = count <span class="comment">// è¯»å…¨å±€å˜é‡</span></span><br><span class="line">      fmt.Printf(<span class="string">"num = %d\n"</span>, num)</span><br><span class="line">      count = num + <span class="number">1</span> <span class="comment">// å†™å…¨å±€å˜é‡</span></span><br><span class="line">    &#125;()</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  wg.Wait()</span><br><span class="line">  <span class="comment">// æ‰€æœ‰goroutineç»“æŸåï¼Œcountå€¼å¹¶ä¸ä¸º5</span></span><br><span class="line">  fmt.Printf(<span class="string">"count = %d\n"</span>, count)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ----------ç¨‹åºè¾“å‡ºç»“æœ(æ¯æ¬¡éƒ½æ˜¯éšæœºçš„)--------</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">num = <span class="number">1</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">num = <span class="number">0</span></span><br><span class="line">count = <span class="number">1</span></span><br></pre></td></tr></table></figure>

<p>ä¸Šè¿°è¿™æ®µä»£ç å¯ä»¥éå¸¸æ˜æ˜¾çš„çœ‹åˆ°ï¼Œ5ä¸ªgoroutineéƒ½å¯¹å…¨å±€å˜é‡<code>count</code>åšäº†åŠ 1çš„è¿ç®—ï¼Œç»“æœcountæœ€ç»ˆå€¼å´æ˜¯1è€Œé5ã€‚è¿™ä¹Ÿè¯´æ˜ï¼Œåœ¨æ²¡æœ‰æªæ–½çš„æƒ…å†µä¸‹å¹¶å‘å»è®¿é—®å…¨å±€å˜é‡ä¼šå‡ºç°è¯¡å¼‚çš„ç»“æœã€‚</p>
<p>é“ç†å¾ˆç®€å•ï¼Œä¸€ä¸ªgoroutineå†è®¿é—®æŸä¸ªèµ„æºæ—¶å¦ä¸€ä¸ªgoroutineå¯èƒ½æ­£åœ¨å†™ï¼Œå¯¼è‡´è®¿é—®ç»“æœä¸ç¬¦åˆé¢„æœŸï¼Œæˆ–è€…ä½ å‰è„šåˆšå†™ï¼Œåè„šå°±è¢«ä»–äººè¦†ç›–äº†ã€‚è¦è§£å†³è¿™ä¸ªé—®é¢˜ï¼ŒGOè¯­è¨€æä¾›äº†ä¸¤ç§ä¼ ç»Ÿæ€è·¯ï¼š</p>
<ol>
<li><p>åŸå­æ“ä½œå‡½æ•°ï¼Œç¡®ä¿æ¯æ¬¡è®¿é—®éƒ½æ˜¯å®Œæ•´çš„è¯»å†™</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// atomicåŒ…é‡Œè¿˜æœ‰å¾ˆå¤šå¦‚è¯»å–ã€å†™å…¥ç­‰å®‰å…¨è®¿é—®å‡½æ•°</span></span><br><span class="line"><span class="comment">// è¿™é‡Œä»…ä½¿ç”¨åŠ æ³•è®¡ç®—</span></span><br><span class="line">atomic.AddInt64(&amp;count, <span class="number">1</span>)</span><br></pre></td></tr></table></figure>
</li>
<li><p>äº’æ–¥é”ï¼Œæˆ‘åœ¨è®¿é—®çš„æ—¶å€™ä½ ä¸å‡†è®¿é—®</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> mutex sync.Mutex <span class="comment">// ç”¨æ¥å®šä¹‰ä»£ç ä¸´ç•ŒåŒº</span></span><br><span class="line">mutex.Lock() <span class="comment">// åŠ é”ï¼Œå…¶å®ƒgoroutineä¼šè¢«é˜»å¡</span></span><br><span class="line">...</span><br><span class="line">mutex.Unlock() <span class="comment">// è§£é”ï¼Œå…¶å®ƒgoroutineç»§ç»­è¿è¡Œ</span></span><br></pre></td></tr></table></figure>

</li>
</ol>
<h2 id="é€šé“"><a href="#é€šé“" class="headerlink" title="é€šé“"></a>é€šé“</h2><p>åŸå­å‡½æ•°å’Œäº’æ–¥é”éƒ½å¯ä»¥å¾ˆå¥½åœ°è§£å†³èµ„æºå…±äº«çš„é—®é¢˜ï¼Œä½†å®ƒä»¬éƒ½ä¸å¤Ÿä¼˜ç§€ï¼Œå› ä¸ºä½ ä¸å¾—ä¸è€ƒè™‘ç¨‹åºçš„è¿è¡Œé€»è¾‘ã€ä¼˜å…ˆçº§ä¹‹ç±»çš„é—®é¢˜ã€‚ä»”ç»†æƒ³æƒ³ï¼Œå…¶å®æˆ‘ä»¬è®¿é—®å…±äº«èµ„æºæ— éæ˜¯ä¸ºäº†ç”Ÿäº§/æ¶ˆè´¹æ•°æ®ï¼Œåªæ˜¯ä¸ºäº†ç¡®ä¿æ•°æ®èƒ½è¢«å®‰å…¨è®¿é—®æ‰å¼•å…¥è¿™æ ·é‚£æ ·çš„ç«äº‰æœºåˆ¶ã€‚é‚£æœ‰æ²¡æœ‰ä¸€ç§åŠæ³•èƒ½è®©å¼€å‘è€…ä¸“æ³¨å¤„ç†æ•°æ®ï¼Œä¸è¦å»æ“å¿ƒé‚£äº›æ¯«ä¸ç›¸å…³çš„ä¸šåŠ¡é€»è¾‘ã€‚ç­”æ¡ˆå°±æ˜¯GOçš„é€šé“æœºåˆ¶ã€‚</p>
<p>ç®€å•æ¥è¯´ï¼Œä¸€ä¸ªgoroutineéœ€è¦è¯»æ•°æ®çš„æ—¶å€™ï¼Œå°±ä»é€šé“é‡Œå»æ‹¿ï¼Œå¤„ç†å®Œäº†å°±æ”¾å›é€šé“ï¼Œè‡³äºé‚£äº›èµ„æºäº’æ–¥ç­‰é—®é¢˜ï¼Œè¿è¡Œæ—¶å·²ç»å¤„ç†å¾—å¾ˆå®Œç¾äº†ã€‚</p>
<h3 id="é€šé“çš„åŸºæœ¬ä½¿ç”¨"><a href="#é€šé“çš„åŸºæœ¬ä½¿ç”¨" class="headerlink" title="é€šé“çš„åŸºæœ¬ä½¿ç”¨"></a>é€šé“çš„åŸºæœ¬ä½¿ç”¨</h3><ul>
<li>ç”¨<code>make</code>å’Œ<code>close</code>æ¥åˆ›å»ºå’Œå…³é—­é€šé“</li>
<li>é€šé“ä¸€èˆ¬è¿è¡Œåœ¨goroutineå‡½æ•°å†…</li>
<li>ä½¿ç”¨<code>&lt;-</code>å®Œæˆé€šé“æ•°æ®çš„è¯»å†™</li>
</ul>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> wg sync.WaitGroup</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¥æ”¶ç«¯goroutine</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">receive</span><span class="params">(data <span class="keyword">chan</span> <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  num := &lt;-data <span class="comment">// å°†é€šé“æ•°æ®è¯»å–åˆ°å˜é‡</span></span><br><span class="line">  fmt.Printf(<span class="string">"received number: %d\n"</span>, num)</span><br><span class="line">  wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å‘é€ç«¯goroutine</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">send</span><span class="params">(data <span class="keyword">chan</span> <span class="keyword">int</span>, num <span class="keyword">int</span>)</span></span> &#123;</span><br><span class="line">  fmt.Printf(<span class="string">"sent number: %d\n"</span>, num)</span><br><span class="line">  data &lt;- num <span class="comment">// å°†æ•°æ®å†™å…¥é€šé“</span></span><br><span class="line">  wg.Done()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// UseChannel é€šé“çš„åŸºæœ¬ä½¿ç”¨</span></span><br><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">UseChannel</span><span class="params">()</span></span> &#123;</span><br><span class="line">  channel := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>) <span class="comment">// åˆ›å»ºä¸€ä¸ªé€šé“</span></span><br><span class="line">  wg.Add(<span class="number">2</span>)</span><br><span class="line">  <span class="keyword">go</span> receive(channel)</span><br><span class="line">  <span class="keyword">go</span> send(channel, <span class="number">20</span>)</span><br><span class="line">  wg.Wait()</span><br><span class="line">  <span class="built_in">close</span>(channel) <span class="comment">// å…³é—­é€šé“</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>

<p>å¦‚ä¸Šä»£ç æ‰€ç¤ºï¼Œé€šè¿‡<code>channel := make(chan int)</code>åˆ›å»ºäº†ä¸€ä¸ªintç±»å‹çš„é€šé“ï¼Œä¸”é€šè¿‡è¯¥é€šé“å®ç°åœ¨<code>recevie</code>å’Œ<code>send</code>ä¸¤ä¸ªgoroutineä¹‹é—´çš„æ•°æ®é€šä¿¡ï¼Œæ³¨æ„<code>channel &lt;- value</code>è¡¨ç¤ºå†™é€šé“ï¼Œ<code>value &lt;- channel</code>è¡¨ç¤ºè¯»é€šé“ã€‚</p>
<p>å¦å¤–ï¼ŒGOæä¾›ä¸¤ç§é€šé“æœºåˆ¶ï¼Œæ— ç¼“å†²é€šé“å’Œæœ‰ç¼“å†²é€šé“ã€‚</p>
<h3 id="æ— ç¼“å†²é€šé“"><a href="#æ— ç¼“å†²é€šé“" class="headerlink" title="æ— ç¼“å†²é€šé“"></a>æ— ç¼“å†²é€šé“</h3><p>é¡¾åæ€ä¹‰ï¼Œæ— ç¼“å†²å°±æ˜¯åœ¨é€šé“å†…ä¸æ²¡æœ‰ç¼“å†²ç©ºé—´ï¼Œå¯¹äºä¸¤ä¸ªgoroutineè€Œè¨€ï¼Œéœ€è¦åŒæ–¹åŒæ—¶åšå¥½å‡†å¤‡æ‰èƒ½è¿›è¡Œæ•°æ®ä¼ é€’ï¼Œå¦åˆ™å…ˆåšå¥½å‡†å¤‡çš„ä¸€æ–¹å°±ä¼šé˜»å¡ï¼Œç­‰å¾…å¦ä¸€æ–¹åšå¥½å‡†å¤‡ã€‚å¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://i.loli.net/2019/02/24/5c7239ab48e43.png" alt="æ— ç¼“å†²é€šé“ç¤ºæ„å›¾"></p>
<p>å…¶å®æœ€å¼€å§‹å…³äº<code>send</code>å’Œ<code>recevie</code>çš„ä¾‹å­å°±æ˜¯å…¸å‹çš„æ— ç¼“å†²é€šé“ï¼Œæ‰€ä»¥å…·ä½“çš„ç”¨æ³•å°±ä¸å†èµ˜è¿°äº†ã€‚</p>
<p>ç•™æ„ä¸€ä¸‹ä¸¤ä¸ªå‡½æ•°ä¸­<code>fmt.Printf</code>çš„é¡ºåºï¼Œå‘é€è€…æ˜¯åœ¨å‘é€æ•°æ®ä¹‹å‰æ‰“å°ï¼Œè€Œæ¥å—è€…æ˜¯åœ¨æ¥æ”¶æ•°æ®ä¹‹åæ‰“å°ã€‚ä¸è¿‡ï¼Œä¸¤ä¸ªå‡½æ•°æ˜¯goroutineï¼Œç†è®ºä¸Šæ¥è¯´ç‹¬è‡ªè¿è¡Œï¼Œæ‰“å°æ²¡æœ‰å…ˆåæ¬¡åºï¼Œä½†ä¸Šè¾¹çš„ä¾‹å­ä¸è®ºè¿è¡Œå¤šå°‘æ¬¡éƒ½æ˜¯å…ˆæ‰“å°<code>â€sent number: xx&quot;</code>å†æ‰“å°<code>â€received number: xx&quot;</code>ã€‚ç”±æ­¤å¯è§ï¼Œå› ä¸ºæ²¡æœ‰ç¼“å†²ï¼Œ<code>num := &lt;-data</code>çš„æ—¶å€™ï¼Œå¦‚æœdataé€šé“çš„å¯¹é¢æ²¡æœ‰åœ¨å†™å…¥ï¼Œè¿™é‡Œå°±ä¼šè¢«é˜»å¡ã€‚</p>
<h3 id="æœ‰ç¼“å†²é€šé“"><a href="#æœ‰ç¼“å†²é€šé“" class="headerlink" title="æœ‰ç¼“å†²é€šé“"></a>æœ‰ç¼“å†²é€šé“</h3><p>åŒç†ï¼Œæœ‰ç¼“å†²å°±æ˜¯åœ¨é€šé“å†…æœ‰ç¼“å†²ç©ºé—´ï¼Œå¯¹äºä¸¤ä¸ªgoroutineè€Œè¨€ï¼Œæ— æ‰€è°“å¯¹æ–¹æœ‰æ²¡æœ‰åšå¥½å‡†å¤‡ï¼Œå®ƒä»¬åªéœ€è¦å…³ç³»é€šé“å†…çš„ç¼“å­˜æœ‰æ²¡æœ‰æ•°æ®ï¼Œå¦‚ä¸‹å›¾æ‰€ç¤ºï¼š</p>
<p><img src="https://i.loli.net/2019/02/24/5c7239d3d806f.png" alt="æœ‰ç¼“å†²é€šé“ç¤ºæ„å›¾"></p>
<p>ä¸‹é¢è¿™æ®µä»£ç ä¹Ÿå±•ç¤ºäº†å¦‚æœè¿ç”¨æœ‰ç¼“å†²é€šé“ï¼Œå…¶å®éå¸¸ç®€å•ï¼Œå°±æ˜¯åœ¨åˆ›å»ºé€šé“çš„æ—¶å€™æŒ‡å®šä¸€ä¸‹é€šé“çš„ç¼“å­˜é•¿åº¦<code>make(chan &lt;type&gt;, &lt;length&gt;)</code>å³å¯ï¼Œå…¶å®ƒåœ°æ–¹å‡ ä¹ä¸ç”¨å˜ã€‚</p>
<figure class="highlight go"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">func</span> <span class="title">BufferChannel</span><span class="params">()</span></span> &#123;</span><br><span class="line">  <span class="comment">// åˆ›å»ºä¸€ä¸ªé•¿åº¦ä¸º10çš„æœ‰ç¼“å†²é€šé“</span></span><br><span class="line">  bufferedChannel := <span class="built_in">make</span>(<span class="keyword">chan</span> <span class="keyword">int</span>, <span class="number">10</span>)</span><br><span class="line">  wg.Add(<span class="number">10</span>)</span><br><span class="line"></span><br><span class="line">  <span class="comment">// å¯åŠ¨5ä¸ªgoroutineæ¥æ”¶æ•°å­—</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">go</span> receive(bufferedChannel)</span><br><span class="line">  &#125;</span><br><span class="line">  <span class="comment">// å¯åŠ¨5ä¸ªgoroutineå‘é€éšæœº5ä¸ªæ•°å­—</span></span><br><span class="line">  <span class="keyword">for</span> i := <span class="number">0</span>; i &lt; <span class="number">5</span>; i++ &#123;</span><br><span class="line">    <span class="keyword">go</span> send(bufferedChannel, rand.Intn(<span class="number">100</span>))</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  wg.Wait()</span><br><span class="line">  <span class="built_in">close</span>(bufferedChannel)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">//---------------ç¨‹åºè¾“å‡ºç»“æœ------------</span></span><br><span class="line">sent number: <span class="number">81</span></span><br><span class="line">received number: <span class="number">81</span></span><br><span class="line">sent number: <span class="number">81</span></span><br><span class="line">sent number: <span class="number">87</span></span><br><span class="line">sent number: <span class="number">47</span></span><br><span class="line">received number: <span class="number">81</span></span><br><span class="line">received number: <span class="number">87</span></span><br><span class="line">received number: <span class="number">47</span></span><br><span class="line">sent number: <span class="number">59</span></span><br><span class="line">received number: <span class="number">59</span></span><br></pre></td></tr></table></figure>

<p>ä»è¿™æ ·çš„ç¨‹åºè¾“å‡ºç»“æœå¯ä»¥æ˜æ˜¾çœ‹åˆ°ï¼Œ<code>receive</code>å’Œ<code>send</code>çš„æ‰§è¡Œæ ¹æœ¬äº’ä¸å½±å“ï¼Œä¸å­˜åœ¨é˜»å¡çš„æƒ…å†µï¼Œå¦åˆ™å°±ä¸ä¼šå‡ºç°è¿ç»­å‘é€å’Œè¿ç»­æ¥æ”¶çš„æ‰“å°äº†ã€‚</p>
<p>ä½†æ˜¯éœ€è¦æ³¨æ„ä¸€ç‚¹ï¼Œå‘é€æ•°å­—å’Œæ¥æ”¶æ•°å­—çš„é¡ºåºç¡®å®ä¸€æ ·çš„ï¼Œä¹Ÿå°±æ˜¯è¯´æœ‰ç¼“å†²é€šé“å†…éƒ¨ï¼Œæ•°æ®æ˜¯æŒ‰ç…§å…ˆè¿›å…ˆå‡ºçš„æ–¹å¼åœ¨ç®¡ç†ã€‚</p>
<h2 id="å°ç»“ä¸€ä¸‹"><a href="#å°ç»“ä¸€ä¸‹" class="headerlink" title="å°ç»“ä¸€ä¸‹"></a>å°ç»“ä¸€ä¸‹</h2><ul>
<li>GOè¯­è¨€å¹¶å‘æ˜¯æŒ‡goroutineï¼Œç”±GOçš„è¿è¡Œæ—¶è´Ÿè´£ç®¡ç†</li>
<li>ä½¿ç”¨<code>go</code>å…³é”®å­—æ¥åˆ›å»ºgoroutine</li>
<li><code>sync/atomic</code>å’Œ<code>sync.Mutex</code>å¯ä»¥è§£å†³å¹¶å‘æ—¶çš„èµ„æºç«äº‰é—®é¢˜</li>
<li>ç›¸æ¯”äºåŸå­å‡½æ•°å’Œäº’æ–¥é”ï¼ŒGOè¯­è¨€çš„é€šé“æœºåˆ¶å¯ä»¥æ›´å¥½åœ°å¤„ç†å…±äº«æ•°æ®</li>
<li>ä½¿ç”¨<code>make(chan &lt;type&gt;)</code>åˆ›å»ºæ— ç¼“å†²é€šé“</li>
<li>ä½¿ç”¨<code>make(chan &lt;type&gt;, &lt;length&gt;)</code>åˆ›å»ºæœ‰ç¼“å†²é€šé“</li>
</ul>

        </div>

        
        <section class="post-tags">
            <span class="tag">
                
                
                    <a href="/tags/GOè¯­è¨€/">GOè¯­è¨€</a>
                
                    
            </span>
        </section>
        <section class="post-nav">
            
                <a class="prev" rel="prev" href="/books/æ¸…é†’æ€è€ƒçš„è‰ºæœ¯/">ã€Šæ¸…é†’æ€è€ƒçš„è‰ºæœ¯ã€‹è¯»ä¹¦ç¬”è®°</a>
            
            
            <a class="next" rel="next" href="/97ThingsEveryProgrammerShouldKnow/28/">ä¸è¦åƒµç›´é’‰æ­»ä½ çš„ç¨‹åº</a>
            
        </section>


    </article>
</div>

        </div>
        <footer id="footer" class="footer">
    <div class="copyright">
        <span>Â© Philon | Powered by <a href="https://hexo.io" target="_blank">Hexo</a> & <a href="https://github.com/Siricee/hexo-theme-Chic" target="_blank">Chic</a></span>
    </div>
</footer>

    </div>
</body>
</html>
